# SNMP
# uses UDP proto
# vulnerable to ip spoofing and replay attacks
# early versions 1,2,2c are not encrypted
# weak authentication, commonly default creds a.k.a. public/private community strings
sudo nmap -sU --open -p 161 10.11.1.1-254
# related tools: onesixtyone, snmpwalk
# http://www.phreedom.org/software/onesixtyone/
# the SNMP Management Information Base (MIB) is a database containing information usually related to network management.

# The IBM Knowledge Center7 contains a wealth of information about the MIB tree.
# https://www.ibm.com/support/knowledgecenter/ssw_aix_71/commprogramming/mib.html

# Microsoft Windows SNMP service MIB tree includes more than just network detail
# you can list running system and user processes, process paths, user accounts, etc.

# enumeration examples:
# list public tree
snmpwalk -c public -v1 -t 10 10.11.1.14
# list windows users
snmpwalk -c public -v1 10.11.1.14 1.3.6.1.4.1.77.1.2.25
# list running processes
snmpwalk -c public -v1 10.11.1.73 1.3.6.1.2.1.25.4.2.1.2
# list open local tcp ports
snmpwalk -c public -v1 10.11.1.14 1.3.6.1.2.1.6.13.1.3
# list installed software
snmpwalk -c public -v1 10.11.1.50 1.3.6.1.2.1.25.6.3.1.2

# port `161 UDP` for queries
# port `162 UPD` for replies (ie. tcpdump/sniffing)
# Protocol variations
# version  | community    | authentication | encryption
# SNMP v1  | "public"     | None           | None
# SNMP v2c | customizable | community      | None
# SNMP v3  | customizable | user/pass      | Yes

# Terminology
# - `PDU` an snmp message (ie. a few types: `GET`, `SET`)
# - `Symbol` human-readable alias string version of an OID
# - `OID` object identifier: the `.1.2.3.4.5` tree-based identifier used as data primary key. many adhere to public normalized schema but a few are vendor-specific
# - `MIB` management information base: any storage aggregating snmp data
# - `Manager` an administrative machine w/ software for aggregating, monitoring, and modifying snmp data gathered from all devices on the network
# - `Community` - secret namespace string agents expect before replying to requests
# - `Agent` snmp-enabled device
# - `trap` programmable condition when agent will one-time udp-lossy push data to manager when an event occurs (ie. cpu hot)
# - `inform` a trap that will recur until manager acknowledges receipt (lossless)

# cheatsheet:
# https://book.hacktricks.xyz/pentesting/pentesting-snmp

# guides:
# https://hackinglethani.com/snmp-protocol/
# https://www.hackers-arise.com/post/2019/03/23/network-basics-for-hackers-simple-network-management-protocol-snmp-theory-reconnaissance

# Finding open snmp ports
sudo nmap -v -sU -Pn -p 161 10.1.1.2
PORT    STATE SERVICE REASON                 VERSION
161/udp open  snmp    udp-response ttl 244   ciscoSystems SNMPv3 server (public)

# Enumerating version
# there are some nse enumeration scripts
nmap --script "snmp* and not snmp-brute" 10.1.1.2

# Finding Community Strings
# SNMP <= v2c
# - sniffing request/reply data on both ports
# - brute force wordlists
onesixtyone /usr/share/seclists/Discovery/SNMP/common-snmp-community-strings.txt 10.1.1.2
hydra -P {Big_Passwordlist} -v {IP} snmp
nmap --script snmp-brute

# Walking the tree for values
snmpwalk -c public -v1 10.1.1.2


# TODO: learn to use `onesixtyone`. it's a parallel scanner
#         and you can blast out udp packets across a CIDR fast
#         and see if any SNMP devices respond
#         much better than checking for open ports, 
#            as many require valid community string to reply

# Bruteforce community strings
echo public > community
echo private >> community
echo manager >> community
for ip in $(seq 200 254); do echo 192.168.11.${ip}; done > ips

onesixtyone -c community -i ips

# Enumerate Windows users
snmpwalk -c public -v1 <IP> 1.3.6.1.4.1.77.1.2.25

# Enumerate current Windows processes
snmpwalk -c public -v1 <IP> 1.3.6.1.2.1.25.4.2.1.2

# Enumerate Windowsâ€™ open TCP ports
snmpwalk -c public -v1 <IP> 1.3.6.1.2.1.6.13.1.3

# Enumerate installed software
snmpwalk -c public -v1 <IP> 1.3.6.1.2.1.25.6.3.1.2



# related tools: `snmpwalk`, `snmpenum`, `snmpcheck`, `trailofbits/onesixtyone`