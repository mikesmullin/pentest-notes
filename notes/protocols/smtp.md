# SMTP
# use `nmap -p 25` to find
# can use `nc` to connect
# `VRFY root` request asks server to verify an email address
# `EXPN` ask server for the membership of a mailing list
# these can reveal users of a system which is useful elsewhere

# TODO: check out Swaks https://www.jetmore.org/john/code/swaks/latest/doc/ref.txt

# smtp enum users
sudo nmap -d --script smtp-enum-users.nse -p 25,465,587 10.11.1.231
PORT    STATE  SERVICE    REASON
25/tcp  open   smtp       syn-ack ttl 63
| smtp-enum-users: 
|_  Method RCPT returned a unhandled status code.

# smtp disclose ntlm
sudo nmap -d --script smtp-ntlm-info --script-args smtp-ntlm-info.domain=WORKGROUP -p 25,465,587 10.11.1.231
PORT    STATE  SERVICE    REASON
25/tcp  open   smtp       syn-ack ttl 63

sudo nmap --script smtp-open-relay.nse --script-args smtp-open-relay.domain=mail.local -p 25 10.11.1.231
PORT   STATE SERVICE
25/tcp open  smtp
|_smtp-open-relay: Server doesn't seem to be an open relay, all tests failed

# smtp manual user enumeration (`VRFY <user>`)
$ nc -v 10.11.1.231 25
Ncat: Version 7.91 ( https://nmap.org/ncat )
Ncat: Connected to 10.11.1.231:25.
220 mail.local ESMTP Postfix (Debian/GNU)

VRFY root
252 2.0.0 root
252 2.0.0 backup
252 2.0.0 nobody
252 2.0.0 sshd
252 2.0.0 mail
252 2.0.0 news

# NOTICE: there are multiple challenges:
# - latency to banner
# - throttling of VRFY requests
# - max error lockout