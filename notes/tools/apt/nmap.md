# remember, using `db_nmap` from within metasploit will store results in PostgreSQL.


```bash
sudo nmap -sV -Pn -p 445 -v 10.10.10.30
```


```bash
nmap -p- --min-rate=1000 -T4 10.10.10.27
```

```bash
ports=$(nmap -p- --min-rate=1000 -T4 10.10.10.27 | grep ^[0-9] | cut -d '/' -f1 | tr '\n' ',' | sed s/,$//)
```

```bash
nmap -sC -sV -p$ports 10.10.10.27
```


# types of scans
# `-sT` aka `CONNECT` = SYN, SYN-ACK, ACK
#   traditional tcp handshake. doesn't require root
# `-sS` aka `SYN` aka stealth = SYN, SYN-ACK
#   since client doesn't send final ack, application layer never recieves connect request
#   requires root. some proxies may filter it. not actually 'stealthy' for modern IDPS.
# `-sU` aka `UDP` scan = assumes open unless ICMP response; some port-specific variations

# `-O` offer guess of OS based on packet structure
# `-sV` inspectservice banners
# `-A` OS and service enumeration scripts


---

# PING

# sometimes ping is blocked but not all the way
# there are different approaches to ping test
# `-PE` `-PM` `-PP` `-PO` try all of these
# Send echo, timestamp requests and subnet mask requests
nmap -PEPM -sP -n 199.66.11.0/24
# Send a pingv6 to multicast.
alive6 <IFACE>
# ping subnet broadcast address
ping -b 1.2.3.255
# ping network broadcast address
ping -b 255.255.255.255

---

# ARP discovery
nmap -sn 1.2.3.4/24
netdiscover -r 1.2.3.4/24

---

# NBT discovery
nbtscan -r 1.2.3.4/24

---

# Packet sniffing
# can look for new hosts this way
tcpdump

---

# Getting deep

# `--reason` shows why STATE is open or closed or filtered
# `--packet-trace` shows tcpdump-like summary of packets received back
#                    look at `seq=` `win=` options and IP to determine if its the same host sending the reply (or a firewall appliance)
# `--traceroute` like traceroute but sneakier and better performance
# `--ip-options` ie. `L 1.2.3.4` to loose-route around a firewall restriction

---

# Nmap Scripting Engine (NSE)
# these scripts are written in Lua

cd /usr/share/nmap/scripts

# useful script examples
nmap 1.2.3.4 --script=smb-os-discovery
nmap --script=dns-zone-transfer -p 53 ns2.megacorpone.com -Pn

# view instructions for a script
nmap --script-help dns-zone-transfer

# This folder also contains a script.db file that serves as an index to all of the scripts with categories. You can run bulk scans by category as well.
cat script.db | grep '"vuln"\|"exploit"'
sudo nmap --script vuln 10.11.1.10


---

# examples

# using nmap to scan for SMB + NetBIOS
nmap -v -p 139,445 10.11.1.1-254

# related scripts
ls -1 /usr/share/nmap/scripts/smb*

# related tools: nbtscan

# scanning for NFS
nmap -sV -p 111 --script=rpcinfo 10.11.1.1-254
ls -1 /usr/share/nmap/scripts/nfs*
nmap -p 111 --script nfs* 10.11.1.72

# check it out, you can use boolean logic to define which scripts
nmap --script "smb* and not smb-enum" 10.1.1.2




---

# related tools: masscan, nc